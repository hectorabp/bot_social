{% extends "base.html" %}

{% block title %}Lista de Correos - Bot Social{% endblock %}

{% block content %}
<div class="section-container">
    <div class="flex justify-between items-center mb-8">
        <div>
            <h2 class="text-3xl font-bold text-gray-800 heading-gradient">Lista de Correos</h2>
            <p class="text-subtitle mt-2">Visualiza y filtra los correos electrónicos registrados.</p>
        </div>
        <a href="/profiles/create" class="btn-primary-custom">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
            Nuevo Perfil
        </a>
    </div>

    <!-- Filtros -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-6 border border-gray-100">
        <form action="/emails" method="GET" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- Ubicación -->
                <div>
                    <label for="id_pais" class="block text-sm font-medium text-gray-700 mb-1">País</label>
                    <select name="id_pais" id="id_pais" class="w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 py-2 px-3 border">
                        <option value="">Todos</option>
                        {% for p in paises %}
                        <option value="{{ p.id }}" {% if request.args.get('id_pais')|int == p.id %}selected{% endif %}>{{ p.pais }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="id_ciudad" class="block text-sm font-medium text-gray-700 mb-1">Ciudad</label>
                    <select name="id_ciudad" id="id_ciudad" class="w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 py-2 px-3 border">
                        <option value="">Todas</option>
                        {% for c in ciudades %}
                        <option value="{{ c.id }}" {% if request.args.get('id_ciudad')|int == c.id %}selected{% endif %}>{{ c.ciudad }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="id_barrio" class="block text-sm font-medium text-gray-700 mb-1">Barrio</label>
                    <select name="id_barrio" id="id_barrio" class="w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 py-2 px-3 border">
                        <option value="">Todos</option>
                        {% for b in barrios %}
                        <option value="{{ b.id }}" {% if request.args.get('id_barrio')|int == b.id %}selected{% endif %}>{{ b.barrio }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- Preferencias -->
                <div>
                    <label for="id_genero" class="block text-sm font-medium text-gray-700 mb-1">Género</label>
                    <select name="id_genero" id="id_genero" class="w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 py-2 px-3 border">
                        <option value="">Todos</option>
                        {% for g in generos %}
                        <option value="{{ g.id }}" {% if request.args.get('id_genero')|int == g.id %}selected{% endif %}>{{ g.genero }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="id_partido_politico" class="block text-sm font-medium text-gray-700 mb-1">Partido Político</label>
                    <select name="id_partido_politico" id="id_partido_politico" class="w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 py-2 px-3 border">
                        <option value="">Todos</option>
                        {% for p in partidos %}
                        <option value="{{ p.id }}" {% if request.args.get('id_partido_politico')|int == p.id %}selected{% endif %}>{{ p.partido_politico }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="id_club_futbol" class="block text-sm font-medium text-gray-700 mb-1">Club de Fútbol</label>
                    <select name="id_club_futbol" id="id_club_futbol" class="w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 py-2 px-3 border">
                        <option value="">Todos</option>
                        {% for c in clubes %}
                        <option value="{{ c.id }}" {% if request.args.get('id_club_futbol')|int == c.id %}selected{% endif %}>{{ c.club_futbol }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="id_ideologia" class="block text-sm font-medium text-gray-700 mb-1">Ideología</label>
                    <select name="id_ideologia" id="id_ideologia" class="w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 py-2 px-3 border">
                        <option value="">Todas</option>
                        {% for i in ideologias %}
                        <option value="{{ i.id }}" {% if request.args.get('id_ideologia')|int == i.id %}selected{% endif %}>{{ i.ideologia }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="id_estilo_musica" class="block text-sm font-medium text-gray-700 mb-1">Estilo Música</label>
                    <select name="id_estilo_musica" id="id_estilo_musica" class="w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 py-2 px-3 border">
                        <option value="">Todos</option>
                        {% for m in musicas %}
                        <option value="{{ m.id }}" {% if request.args.get('id_estilo_musica')|int == m.id %}selected{% endif %}>{{ m.estilo_musica }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- Redes Sociales -->
            <div class="flex flex-wrap gap-4 items-center pt-2 border-t border-gray-100">
                <span class="text-sm font-medium text-gray-700">Redes Sociales:</span>
                <label class="inline-flex items-center">
                    <input type="checkbox" name="has_FB" value="1" class="rounded border-gray-300 text-primary focus:ring-primary" {% if request.args.get('has_FB') %}checked{% endif %}>
                    <span class="ml-2 text-sm text-gray-600">Facebook</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="checkbox" name="has_IG" value="1" class="rounded border-gray-300 text-primary focus:ring-primary" {% if request.args.get('has_IG') %}checked{% endif %}>
                    <span class="ml-2 text-sm text-gray-600">Instagram</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="checkbox" name="has_TW" value="1" class="rounded border-gray-300 text-primary focus:ring-primary" {% if request.args.get('has_TW') %}checked{% endif %}>
                    <span class="ml-2 text-sm text-gray-600">Twitter/X</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="checkbox" name="has_TK" value="1" class="rounded border-gray-300 text-primary focus:ring-primary" {% if request.args.get('has_TK') %}checked{% endif %}>
                    <span class="ml-2 text-sm text-gray-600">TikTok</span>
                </label>
                
                <div class="flex-grow"></div>
                
                <div class="mr-4 flex items-center text-sm text-gray-600 bg-gray-50 px-3 py-1.5 rounded-md border border-gray-200">
                    <span class="mr-2">Total encontrados:</span>
                    <span class="font-bold text-gray-900 text-base">{{ pagination.total if pagination else 0 }}</span>
                </div>
                
                <button type="submit" class="bg-gray-800 hover:bg-gray-900 text-white font-medium py-2 px-6 rounded-md transition-colors flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg>
                    Filtrar
                </button>
                <a href="/emails" class="text-gray-500 hover:text-gray-700 text-sm font-medium underline">Limpiar</a>
            </div>
        </form>
    </div>

    <!-- Tabla -->
    <div class="bg-white rounded-lg shadow-md overflow-hidden border border-gray-200">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre Completo</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Correo Electrónico</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ubicación</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Género</th>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% if profiles %}
                        {% for profile in profiles %}
                        <tr class="hover:bg-gray-50 transition-colors">
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">#{{ profile.id }}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <button onclick='openProfileModal({{ profile | tojson | safe }})' class="text-sm font-medium text-gray-900 hover:text-blue-600 hover:underline focus:outline-none text-left">
                                    {{ profile.nombre }} {{ profile.apellido }}
                                </button>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-blue-600 hover:text-blue-800">{{ profile.correo }}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">{{ profile.pais if profile.pais else '-' }}</div>
                                <div class="text-xs text-gray-500">{{ profile.ciudad if profile.ciudad else '-' }}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                {{ profile.genero if profile.genero else '-' }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <a href="#" class="text-primary hover:text-blue-900 mr-3">Editar</a>
                                <a href="#" class="text-red-600 hover:text-red-900">Eliminar</a>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="6" class="px-6 py-10 text-center text-gray-500">
                                No se encontraron perfiles registrados.
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
        
        <!-- Paginación (Simple) -->
        {% if pagination %}
        <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                <div>
                    <p class="text-sm text-gray-700">
                        Mostrando página <span class="font-medium">{{ pagination.page }}</span> de <span class="font-medium">{{ pagination.total_pages }}</span>
                    </p>
                </div>
                <div>
                    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                        {% if pagination.page > 1 %}
                        <a href="{{ url_for('web.email_list', page=pagination.page-1, **request.args) }}" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">Anterior</span>
                            <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                            </svg>
                        </a>
                        {% endif %}
                        
                        {% if pagination.page < pagination.total_pages %}
                        <a href="{{ url_for('web.email_list', page=pagination.page+1, **request.args) }}" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">Siguiente</span>
                            <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                            </svg>
                        </a>
                        {% endif %}
                    </nav>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Profile Modal -->
<div id="profileModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden overflow-y-auto h-full w-full z-50 flex items-center justify-center backdrop-blur-sm">
    <div class="relative mx-auto p-0 border w-11/12 md:w-3/4 lg:w-2/3 shadow-2xl rounded-xl bg-white overflow-hidden animate-fade-in-up">
        <!-- Header -->
        <div class="bg-gray-800 px-6 py-4 flex justify-between items-center">
            <h3 class="text-xl font-bold text-white flex items-center gap-2">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                Detalles del Perfil
            </h3>
            <button onclick="closeProfileModal()" class="text-gray-300 hover:text-white transition-colors focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        
        <!-- Body -->
        <div class="p-6 max-h-[80vh] overflow-y-auto">
            <div class="flex flex-col md:flex-row gap-8">
                <!-- Left Column: Photo & Basic Info -->
                <div class="w-full md:w-1/3 flex flex-col items-center text-center border-b md:border-b-0 md:border-r border-gray-200 pb-6 md:pb-0 md:pr-6">
                    <div class="relative mb-4 group">
                        <img id="modal-photo" src="" alt="Foto de Perfil" class="w-40 h-40 rounded-full object-cover border-4 border-gray-100 shadow-lg">
                        <div class="absolute inset-0 rounded-full bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-all duration-300"></div>
                    </div>
                    <h4 id="modal-fullname" class="text-xl font-bold text-gray-800 mb-1"></h4>
                    <p id="modal-email" class="text-sm text-blue-600 font-medium mb-4 break-all"></p>
                    
                    <div class="w-full space-y-3 text-left bg-gray-50 p-4 rounded-lg">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">ID:</span>
                            <span id="modal-id" class="font-medium text-gray-900"></span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Teléfono:</span>
                            <span id="modal-phone" class="font-medium text-gray-900"></span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Nacimiento:</span>
                            <span id="modal-birthdate" class="font-medium text-gray-900"></span>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Details -->
                <div class="w-full md:w-2/3 space-y-6">
                    <!-- Ubicación -->
                    <div>
                        <h5 class="text-sm uppercase tracking-wide text-gray-500 font-bold mb-3 border-b pb-1">Ubicación</h5>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div><span class="text-xs text-gray-400 block">País</span><span id="modal-country" class="text-sm font-medium text-gray-800"></span></div>
                            <div><span class="text-xs text-gray-400 block">Ciudad</span><span id="modal-city" class="text-sm font-medium text-gray-800"></span></div>
                            <div><span class="text-xs text-gray-400 block">Barrio</span><span id="modal-neighborhood" class="text-sm font-medium text-gray-800"></span></div>
                            <div><span class="text-xs text-gray-400 block">Dirección</span><span id="modal-address" class="text-sm font-medium text-gray-800"></span></div>
                        </div>
                    </div>

                    <!-- Preferencias -->
                    <div>
                        <h5 class="text-sm uppercase tracking-wide text-gray-500 font-bold mb-3 border-b pb-1">Preferencias</h5>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div><span class="text-xs text-gray-400 block">Género</span><span id="modal-gender" class="text-sm font-medium text-gray-800"></span></div>
                            <div><span class="text-xs text-gray-400 block">Partido Político</span><span id="modal-party" class="text-sm font-medium text-gray-800"></span></div>
                            <div><span class="text-xs text-gray-400 block">Club de Fútbol</span><span id="modal-club" class="text-sm font-medium text-gray-800"></span></div>
                            <div><span class="text-xs text-gray-400 block">Ideología</span><span id="modal-ideology" class="text-sm font-medium text-gray-800"></span></div>
                            <div><span class="text-xs text-gray-400 block">Estilo Música</span><span id="modal-music" class="text-sm font-medium text-gray-800"></span></div>
                        </div>
                    </div>

                    <!-- Redes Sociales -->
                    <div>
                        <h5 class="text-sm uppercase tracking-wide text-gray-500 font-bold mb-3 border-b pb-1">Redes Sociales</h5>
                        <div class="grid grid-cols-1 gap-3">
                            <!-- Facebook -->
                            <div class="bg-blue-50 p-3 rounded-lg border border-blue-100">
                                <div class="flex items-center mb-1">
                                    <svg class="w-4 h-4 text-blue-600 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                                    <span class="font-bold text-blue-800 text-xs">Facebook</span>
                                </div>
                                <div class="grid grid-cols-2 gap-2 text-sm">
                                    <div><span class="text-xs text-gray-400">Usuario:</span> <span id="modal-fb-user" class="font-mono text-gray-700"></span></div>
                                    <div><span class="text-xs text-gray-400">Pass:</span> <span id="modal-fb-pass" class="font-mono text-gray-700"></span></div>
                                </div>
                            </div>
                            <!-- Instagram -->
                            <div class="bg-pink-50 p-3 rounded-lg border border-pink-100">
                                <div class="flex items-center mb-1">
                                    <svg class="w-4 h-4 text-pink-600 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.069-4.85.069-3.204 0-3.584-.012-4.849-.069-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                                    <span class="font-bold text-pink-800 text-xs">Instagram</span>
                                </div>
                                <div class="grid grid-cols-2 gap-2 text-sm">
                                    <div><span class="text-xs text-gray-400">Usuario:</span> <span id="modal-ig-user" class="font-mono text-gray-700"></span></div>
                                    <div><span class="text-xs text-gray-400">Pass:</span> <span id="modal-ig-pass" class="font-mono text-gray-700"></span></div>
                                </div>
                            </div>
                            <!-- Twitter -->
                            <div class="bg-gray-100 p-3 rounded-lg border border-gray-200">
                                <div class="flex items-center mb-1">
                                    <svg class="w-4 h-4 text-gray-800 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                    <span class="font-bold text-gray-800 text-xs">Twitter / X</span>
                                </div>
                                <div class="grid grid-cols-2 gap-2 text-sm">
                                    <div><span class="text-xs text-gray-400">Usuario:</span> <span id="modal-tw-user" class="font-mono text-gray-700"></span></div>
                                    <div><span class="text-xs text-gray-400">Pass:</span> <span id="modal-tw-pass" class="font-mono text-gray-700"></span></div>
                                </div>
                            </div>
                            <!-- TikTok -->
                            <div class="bg-gray-50 p-3 rounded-lg border border-gray-200">
                                <div class="flex items-center mb-1">
                                    <svg class="w-4 h-4 text-black mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/></svg>
                                    <span class="font-bold text-gray-800 text-xs">TikTok</span>
                                </div>
                                <div class="grid grid-cols-2 gap-2 text-sm">
                                    <div><span class="text-xs text-gray-400">Usuario:</span> <span id="modal-tk-user" class="font-mono text-gray-700"></span></div>
                                    <div><span class="text-xs text-gray-400">Pass:</span> <span id="modal-tk-pass" class="font-mono text-gray-700"></span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="bg-gray-50 px-6 py-4 flex justify-end">
            <button onclick="closeProfileModal()" class="bg-gray-800 text-white px-4 py-2 rounded-md hover:bg-gray-900 transition-colors">
                Cerrar
            </button>
        </div>
    </div>
</div>

<script>
    function openProfileModal(profile) {
        const modal = document.getElementById('profileModal');
        const noData = '<span class="text-gray-400 italic">Sin datos</span>';
        
        // Helper to set text or "Sin datos"
        const setText = (id, value) => {
            const el = document.getElementById(id);
            if (el) el.innerHTML = (value && value !== 'None' && value !== '') ? value : noData;
        };

        // Basic Info
        document.getElementById('modal-fullname').textContent = `${profile.nombre} ${profile.apellido}`;
        setText('modal-email', profile.correo);
        setText('modal-id', `#${profile.id}`);
        setText('modal-phone', profile.telefono);
        
        // Formatear fecha de nacimiento
        let birthDateDisplay = profile.fecha_nacimiento;
        if (profile.fecha_nacimiento && profile.fecha_nacimiento !== 'None') {
            const date = new Date(profile.fecha_nacimiento);
            if (!isNaN(date.getTime())) {
                // Opciones para formato: 2 de mayo de 1997
                birthDateDisplay = date.toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' });
            }
        }
        setText('modal-birthdate', birthDateDisplay);
        
        // Photo (Placeholder based on name)
        const photoUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(profile.nombre + '+' + profile.apellido)}&background=random&size=256`;
        document.getElementById('modal-photo').src = photoUrl;

        // Location
        setText('modal-country', profile.pais);
        setText('modal-city', profile.ciudad);
        setText('modal-neighborhood', profile.barrio);
        setText('modal-address', profile.calle || profile.referencia_direccion);

        // Preferences
        setText('modal-gender', profile.genero);
        setText('modal-party', profile.partido_politico);
        setText('modal-club', profile.club_futbol);
        setText('modal-ideology', profile.ideologia);
        setText('modal-music', profile.estilo_musica);

        // Social Media
        setText('modal-fb-user', profile.cuenta_FB);
        setText('modal-fb-pass', profile.password_FB);
        setText('modal-ig-user', profile.cuenta_IG);
        setText('modal-ig-pass', profile.password_IG);
        setText('modal-tw-user', profile.cuenta_TW);
        setText('modal-tw-pass', profile.password_TW);
        setText('modal-tk-user', profile.cuenta_TK);
        setText('modal-tk-pass', profile.password_TK);

        modal.classList.remove('hidden');
    }

    function closeProfileModal() {
        document.getElementById('profileModal').classList.add('hidden');
    }
    
    // Close on click outside
    document.getElementById('profileModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeProfileModal();
        }
    });
</script>
{% endblock %}